# üéÖ Moroz Wishlist Bot

Telegram-–±–æ—Ç –¥–ª—è —Å–±–æ—Ä–∞ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –∂–µ–ª–∞–Ω–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—Å—ã–ª–æ–∫.

![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)
![License](https://img.shields.io/badge/license-MIT-blue.svg)

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- üéÑ –†–∞—Å—Å–∫–∞–∑–∞—Ç—å —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ –î–µ–¥—É –ú–æ—Ä–æ–∑—É
- üéÅ –ó–∞–≥–∞–¥–∞—Ç—å 3 –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –∂–µ–ª–∞–Ω–∏—è
- ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–∏ –∂–µ–ª–∞–Ω–∏—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- üìù –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –∂–µ–ª–∞–Ω–∏–π

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø—Ä–∞–≤–∞)
- üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∂–µ–ª–∞–Ω–∏–π –∏ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–π
- üí¨ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã
- üì¢ –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- üîê –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js 18+** - —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **Express** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è webhook
- **MySQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **node-telegram-bot-api** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Telegram API
- **Winston** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **PM2** - process manager –¥–ª—è production

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18 –∏–ª–∏ –≤—ã—à–µ
- MySQL 5.7+ –∏–ª–∏ MariaDB 10.3+
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))
- HTTPS –¥–æ–º–µ–Ω (–¥–ª—è webhook)

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

\`\`\`bash
git clone https://github.com/mickeybroud/moroz-wishlist-bot.git
cd moroz-wishlist-bot
\`\`\`

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

\`\`\`bash
npm install
\`\`\`

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

\`\`\`bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
mysql -u root -p

CREATE DATABASE moroz_wishlist_bot CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE moroz_wishlist_bot;

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
source migrations/schema.sql;

EXIT;
\`\`\`

### –®–∞–≥ 4: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

\`\`\`bash
cp .env.example .env
nano .env
\`\`\`

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

\`\`\`env
# Telegram Bot
BOT_TOKEN=your_bot_token_here

# Webhook
WEBHOOK_URL=https://your-domain.com
WEBHOOK_SECRET=random-secret-key
WEBHOOK_SECRET_TOKEN=another-random-token

# Database
DB_HOST=localhost
DB_PORT=3306
DB_NAME=moroz_wishlist_bot
DB_USER=root
DB_PASSWORD=

# Environment
NODE_ENV=production
PORT=3000

# Logging
LOG_LEVEL=info

# Path
ENV_PATH=/home/dev/moroz-wishlist-bot/.env
\`\`\`

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç webhook –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –£ –≤–∞—Å –µ—Å—Ç—å HTTPS –¥–æ–º–µ–Ω
- Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç 3000

### –®–∞–≥ 6: –ó–∞–ø—É—Å–∫

#### Development:
\`\`\`bash
npm run dev
\`\`\`

#### Production (—Å PM2):
\`\`\`bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
npm install -g pm2

# –ó–∞–ø—É—Å–∫
pm2 start index.js --name moroz-wishlist-bot

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
pm2 startup
pm2 save

# –õ–æ–≥–∏
pm2 logs moroz-wishlist-bot

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 monit
\`\`\`

## üìö –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º |
| `/wishes` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –∂–µ–ª–∞–Ω–∏—è |
| `/info` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ |

### –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/admin` | –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å |
| `/wish` | –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∂–µ–ª–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `/poem` | –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è |
| `/users` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `/ban @username` | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/unban @username` | –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/op @username` | –í—ã–¥–∞—Ç—å –∞–¥–º–∏–Ω-–ø—Ä–∞–≤–∞ |
| `/deop @username` | –ó–∞–±—Ä–∞—Ç—å –∞–¥–º–∏–Ω-–ø—Ä–∞–≤–∞ |
| `/talk` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É |
| `/talkall` | –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º |

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

\`\`\`
moroz-wishlist-bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ core/           # –Ø–¥—Ä–æ (Database, TelegramBot, Router)
‚îÇ   ‚îú‚îÄ‚îÄ handlers/       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware/     # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils/          # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ migrations/         # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ logs/              # –õ–æ–≥–∏
‚îú‚îÄ‚îÄ index.js           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
\`\`\`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Prepared Statements –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- ‚úÖ Whitelist –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –ø—É—Ç—å webhook
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—ã (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã:

- **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- **wishes** - –∂–µ–ª–∞–Ω–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
- **command_logs** - –ª–æ–≥–∏ –∫–æ–º–∞–Ω–¥
- **bot_chats** - –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã
- **pending_broadcasts** - –æ—á–µ—Ä–µ–¥—å —Ä–∞—Å—Å—ã–ª–æ–∫

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

\`\`\`javascript
// –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

// 1. –í CommandHandler.js
async handleMyCommand(chatId, username, text, message) {
    // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
}

// 2. –í Router.js
registerCommands(handler) {
    this.commands.set('/mycommand', handler.handleMyCommand.bind(handler));
}
\`\`\`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

\`\`\`bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
node --check index.js

# –ó–∞–ø—É—Å–∫ –≤ dev-—Ä–µ–∂–∏–º–µ
npm run dev

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/combined.log
\`\`\`

## üìù Workflow

1. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:** –ö–æ–¥ –ø–∏—à–µ—Ç—Å—è –≤ `/home/dev/moroz-wishlist-bot`
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** `npm run dev`
3. **–ö–æ–º–º–∏—Ç:** `git commit -m "feature: ..."`
4. **Push:** `git push`
5. **Production:** `cd /var/www/moroz-wishlist-bot && git pull && pm2 restart`

## üêõ Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:
\`\`\`bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook
curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs moroz-wishlist-bot
\`\`\`

### –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
\`\`\`bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
mysql -u root -p moroz_wishlist_bot

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env
cat .env | grep DB_
\`\`\`

### –ü—Ä–æ–±–ª–µ–º—ã —Å PM2:
\`\`\`bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart moroz-wishlist-bot

# –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 delete moroz-wishlist-bot
pm2 start index.js --name moroz-wishlist-bot
pm2 save
\`\`\`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

[@cape0town](https://t.me/cape0town)

## ü§ù –í–∫–ª–∞–¥

Pull requests –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –î–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ issue.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Issues](https://github.com/mickeybroud/moroz-wishlist-bot/issues)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Issue
3. –ù–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –≤ Telegram

---

‚≠ê –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É –Ω–∞ GitHub!
\`\`\`

---

### Deployment:
```bash
cd /home/dev/moroz-wishlist-bot
git add .
git commit -m "feat: group protection, broadcast, README"
git push

cd /var/www/moroz-wishlist-bot
git pull
pm2 restart moroz-wishlist-bot
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞ (—Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É):
```bash
mysql -u root -p moroz_wishlist_bot
UPDATE users SET is_admin = 1 WHERE username = 'your_username';
EXIT;
```

–ì–æ—Ç–æ–≤–æ! üéâ